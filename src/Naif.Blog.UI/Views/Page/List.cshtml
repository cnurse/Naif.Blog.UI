@using Naif.Blog.Razor.Framework
@using Naif.Blog.Razor.Menus
@using Naif.Blog.UI.ViewModels

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

@model Naif.Blog.UI.ViewModels.BlogViewModel

@{
    Layout = "_AdminLayout";

    var pageState = new PageState { User = Model.User };
    
    var pages = Model.Pages.Select(page => new SelectListItem { Value = page.PostId, Text = page.Title }).ToList();
    pages.Insert(0, new SelectListItem { Value="", Text="<-None Selected->"});
    var editPostViewModel = new EditPostViewModel()
    {
        ActionUrl = "/page/save",
        Messages = Model.Messages,
        PageIndex = Model.PageIndex,
        Post = Model.Post.ToPostViewModel(),
        Pages = pages
    };
}


<div class="row">
    <div class="col-lg-4">
        <h2>Manage Pages</h2>
        <component type="typeof(SideBar)"
                   render-mode="ServerPrerendered"
                   param-BaseUrl = "@Model.BaseUrl"
                   param-CssClass="@("list-group list-group-flush")"
                   param-Depth="4"
                   param-PageState="@pageState"
                   param-PostId="@String.Empty"
                   param-Posts="@Model.Pages.ToList()"
                   param-SelectedPost="@Model.Post"
                   param-SubMenuCssClass="@("list-group list-group-flush")">
        </component>
    </div>
    <div class="col-lg-8">
        <h2>Edit Post - @Model.Post.Title</h2>
        @await Html.PartialAsync("../Shared/_EditPost.cshtml", editPostViewModel);
    </div>
</div>

